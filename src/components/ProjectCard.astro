---
import Badge from './Badge.astro';
import Icon from './Icon.astro';
import { formatDate, formatNumber, withBase } from '../lib/utils';
import { statusStyles } from '../lib/status';

const { project, dataAttrs = {}, compact = false } = Astro.props;
const status = statusStyles[project.status];
---

<article class={`card flex h-full flex-col gap-6 p-6 ${compact ? 'sm:p-5' : ''}`} {...dataAttrs}>
  <div class="flex items-start justify-between gap-4">
    <div class="space-y-2">
      <p class="text-xs uppercase tracking-[0.2em] text-blue-500/80 dark:text-blue-300/80">Project</p>
      <a href={withBase(`/projects/${project.slug}/`)} class="text-xl font-semibold text-slate-900 transition hover:text-blue-600 dark:text-white dark:hover:text-blue-300">
        {project.displayName}
      </a>
      <p class="text-sm text-slate-600 dark:text-slate-300">{project.description}</p>
    </div>
    <span class={`rounded-full px-3 py-1 text-xs font-semibold ${status.tone}`}>{status.label}</span>
  </div>

  <div class="flex flex-wrap gap-2">
    <Badge label={`${formatNumber(project.stars)} stars`} icon="star" />
    <Badge label={project.language} icon="code" />
    <Badge label={project.latestRelease ? `Release ${project.latestRelease.tag}` : 'No releases'} icon="tag" />
    <Badge label={`Updated ${formatDate(project.updatedAt)}`} icon="calendar" />
  </div>

  <div class="mt-auto flex flex-wrap gap-3 text-sm">
    <a
      class="inline-flex items-center gap-2 rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-blue-600 transition hover:border-blue-300 hover:text-blue-700 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-200"
      href={withBase(`/projects/${project.slug}/`)}
    >
      <Icon name="arrow-up-right" class="h-4 w-4" />
      Details
    </a>
    <a
      class="inline-flex items-center gap-2 rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:border-slate-300 hover:text-slate-900 dark:border-slate-800 dark:text-slate-200 dark:hover:text-white"
      href={project.url}
      target="_blank"
      rel="noreferrer"
    >
      <Icon name="github" class="h-4 w-4" />
      Repo
    </a>
    {project.docsUrl ? (
      <a
        class="inline-flex items-center gap-2 rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:border-slate-300 hover:text-slate-900 dark:border-slate-800 dark:text-slate-200 dark:hover:text-white"
        href={project.docsUrl}
        target="_blank"
        rel="noreferrer"
      >
        <Icon name="book-open" class="h-4 w-4" />
        Docs
      </a>
    ) : null}
    {project.crateUrl ? (
      <a
        class="inline-flex items-center gap-2 rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:border-slate-300 hover:text-slate-900 dark:border-slate-800 dark:text-slate-200 dark:hover:text-white"
        href={project.crateUrl}
        target="_blank"
        rel="noreferrer"
      >
        <Icon name="package" class="h-4 w-4" />
        Crate
      </a>
    ) : null}
  </div>
</article>
