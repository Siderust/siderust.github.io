---
import lucide from 'lucide-static';

const icons = 'icons' in lucide ? lucide.icons : lucide;

const { name, class: className = 'h-5 w-5', title } = Astro.props;

if (!name) {
  throw new Error('Icon component requires a name prop.');
}

const normalizeName = (value) =>
  value
    .split('-')
    .map((part) => (part ? `${part[0].toUpperCase()}${part.slice(1)}` : ''))
    .join('');

const normalizedName = normalizeName(name);
const rawIcon = icons[normalizedName] ?? icons[name];
if (!rawIcon) {
  throw new Error(`Unknown icon: ${name}`);
}

const attributes = [
  `class="${className}"`,
  title ? `role="img" aria-label="${title}"` : 'aria-hidden="true" focusable="false"',
].join(' ');

let svg = rawIcon.replace('width="24" height="24"', 'width="100%" height="100%"');
svg = svg.replace('<svg', `<svg ${attributes}`);
if (title) {
  svg = svg.replace('>', `><title>${title}</title>`);
}
---

<span class="inline-flex" set:html={svg}></span>
